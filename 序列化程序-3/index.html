
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="kotlin序列化中文文档">
      
      
        <meta name="author" content="knightwood">
      
      
      
        <link rel="prev" href="../%E5%86%85%E7%BD%AE%E7%B1%BB-2/">
      
      
        <link rel="next" href="../%E5%A4%9A%E6%80%81%E6%80%A7-4/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>序列化程序 - kotlin序列化中文文档</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="kotlin序列化中文文档" class="md-header__button md-logo" aria-label="kotlin序列化中文文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            kotlin序列化中文文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              序列化程序
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Knightwood/kotlin-serialization-docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="kotlin序列化中文文档" class="md-nav__button md-logo" aria-label="kotlin序列化中文文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    kotlin序列化中文文档
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Knightwood/kotlin-serialization-docs" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    简单入门使用文档
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%9F%BA%E6%9C%AC%E5%BA%8F%E5%88%97%E5%8C%96-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    序列化的基本使用
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%86%85%E7%BD%AE%E7%B1%BB-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内置类
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    序列化程序
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    序列化程序
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      序列化程序简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="序列化程序简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      插件生成的序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      插件生成的泛型序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      内置基元序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      构造集合序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      使用顶级序列化程序功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      自定义序列化程序
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义序列化程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      基本类型序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      委派序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      通过代理项的复合序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      手写复合序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      顺序解码协议（实验性）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      序列化第三方类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      手动传递序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      在属性上指定序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      为特定类型指定序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      指定文件的序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typealias" class="md-nav__link">
    <span class="md-ellipsis">
      使用 typealias 全局指定序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      泛型类型的自定义序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      特定于格式的序列化程序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      上下文序列化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="上下文序列化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      序列化模块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      上下文序列化和泛型类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kotlin" class="md-nav__link">
    <span class="md-ellipsis">
      为另一个 Kotlin 类派生外部序列化程序（实验性）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="为另一个 Kotlin 类派生外部序列化程序（实验性）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      外部序列化使用属性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%A4%9A%E6%80%81%E6%80%A7-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多态性
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../JSON%E7%89%B9%E6%80%A7-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    配置Json序列化器功能
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9B%BF%E4%BB%A3%E6%A0%BC%E5%BC%8F%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F%EF%BC%88%E5%AE%9E%E9%AA%8C%E6%80%A7%EF%BC%89-6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    替代格式和自定义格式（实验性）
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E9%99%84%E5%BD%95%20A.%20%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%80%BC%E7%B1%BB%EF%BC%88%E4%BB%85%E9%99%90%20IR%EF%BC%89/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    序列化和值类（特定于 IR）
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      序列化程序简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="序列化程序简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      插件生成的序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      插件生成的泛型序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      内置基元序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      构造集合序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      使用顶级序列化程序功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      自定义序列化程序
    </span>
  </a>
  
    <nav class="md-nav" aria-label="自定义序列化程序">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      基本类型序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      委派序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      通过代理项的复合序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      手写复合序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      顺序解码协议（实验性）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      序列化第三方类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      手动传递序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      在属性上指定序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      为特定类型指定序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      指定文件的序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typealias" class="md-nav__link">
    <span class="md-ellipsis">
      使用 typealias 全局指定序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      泛型类型的自定义序列化程序
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      特定于格式的序列化程序
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      上下文序列化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="上下文序列化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      序列化模块
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      上下文序列化和泛型类
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kotlin" class="md-nav__link">
    <span class="md-ellipsis">
      为另一个 Kotlin 类派生外部序列化程序（实验性）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="为另一个 Kotlin 类派生外部序列化程序（实验性）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      外部序列化使用属性
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="_1">序列化程序<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>This is the third chapter of the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serialization-guide.md">Kotlin Serialization Guide</a>. In this chapter we&rsquo;ll take a look at serializers in more detail, and we&rsquo;ll see how custom serializers can be written.<br />
这是《Kotlin 序列化指南》的第三章。在本章中，我们将更详细地介绍序列化程序，并了解如何编写自定义序列化程序。</p>
<h2 id="_2">序列化程序简介<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Introduction to serializers</p>
<p>Formats, like JSON, control the <em>encoding</em> of an object into specific output bytes, but how the object is decomposed into its constituent properties is controlled by a <em>serializer</em>. So far we&rsquo;ve been using automatically-derived serializers by using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializable/index.html"><code>@Serializable</code></a> annotation as explained in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#serializable-classes">Serializable classes</a> section, or using builtin serializers that were shown in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/builtin-classes.md">Builtin classes</a> section.  </p>
<p>格式（如 JSON）控制着将对象编码为特定输出字节的编码，但如何将对象分解为其组成属性则由序列化器控制。到目前为止，我们一直通过使用 [<code>@Serializable</code>]注解（如 [Serializable classes] 部分所述）来使用自动派生的序列化器，或者使用 [Builtin classes] 部分所示的内置序列化器。 </p>
<p>As a motivating example, let us take the following <code>Color</code> class with an integer value storing its <code>rgb</code> bytes.<br />
作为一个激励性的例子，让我们以下面的 <code>Color</code> 类为例，该类具有存储其 <code>rgb</code> 字节的整数值。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nd">@Serializable</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">x00ff00</span><span class="p">)</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">green</span><span class="p">))</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-01.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>By default this class serializes its <code>rgb</code> property into JSON.<br />
默认情况下，此类将其 <code>rgb</code> 属性序列化为 JSON。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>{&quot;rgb&quot;:65280}
</span></code></pre></div>
<h3 id="_3">插件生成的序列化程序<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>Plugin-generated serializer</p>
<p>Every class marked with the <code>@Serializable</code> annotation, like the <code>Color</code> class from the previous example, gets an instance of the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a> interface automatically generated by the Kotlin Serialization compiler plugin. We can retrieve this instance using the <code>.serializer()</code> function on the class&rsquo;s companion object.  </p>
<p>与上一个示例中的 <code>Color</code> 类一样，每个标有 <code>@Serializable</code> 注释的类都会获得由 Kotlin 序列化编译器插件自动生成的 KSerializer 接口的实例。我们可以使用类的伴随对象上的 <code>.serializer()</code> 函数来检索此实例。</p>
<p>We can examine its <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/descriptor.html">descriptor</a> property that describes the structure of the serialized class. We&rsquo;ll learn more details about that in the upcoming sections.  </p>
<p>我们可以检查其描述序列化类结构的描述符属性。我们将在接下来的章节中了解更多详细信息。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">colorSerializer</span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">.</span><span class="na">serializer</span><span class="p">()</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">colorSerializer</span><span class="p">.</span><span class="na">descriptor</span><span class="p">)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-02.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Color(rgb: kotlin.Int)
</span></code></pre></div>
<p>This serializer is automatically retrieved and used by the Kotlin Serialization framework when the <code>Color</code> class is itself serialized, or when it is used as a property of other classes.  </p>
<p>当 <code>Color</code> 类本身序列化时，或者当它被用作其他类的属性时，Kotlin 序列化框架会自动检索和使用此序列化程序。</p>
<blockquote>
<p>You cannot define your own function <code>serializer()</code> on a companion object of a serializable class.<br />
不能在可序列化类的伴随对象上定义自己的函数 <code>serializer()</code> 。</p>
</blockquote>
<h3 id="_4">插件生成的泛型序列化程序<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>Plugin-generated generic serializer</p>
<p>For generic classes, like the <code>Box</code> class shown in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#generic-classes">Generic classes</a> section, the automatically generated <code>.serializer()</code> function accepts as many parameters as there are type parameters in the corresponding class. These parameters are of type <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a>, so the actual type argument&rsquo;s serializer has to be provided when constructing an instance of a serializer for a generic class.  </p>
<p>对于泛型类（如泛型类“部分中显示的 <code>Box</code> 类），自动生成 <code>.serializer()</code> 的函数接受的参数数量与相应类中的类型参数数量一样多。这些参数的类型为 KSerializer，因此在为泛型类构造序列化程序的实例时，必须提供实际类型参数的序列化程序。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nd">@Serializable</span><span class="w">           </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;Box&quot;</span><span class="p">)</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">contents</span><span class="p">:</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w">    </span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">boxedColorSerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Box</span><span class="p">.</span><span class="na">serializer</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">serializer</span><span class="p">())</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">boxedColorSerializer</span><span class="p">.</span><span class="na">descriptor</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="p">}</span><span class="w"> </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-03.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>As we can see, a serializer was instantiated to serialize a concrete <code>Box&lt;Color&gt;</code>.<br />
正如我们所看到的，序列化器被实例化为序列化一个具体 <code>Box&lt;Color&gt;</code> 的 .</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Box(contents: Color)
</span></code></pre></div>
<h3 id="_5">内置基元序列化程序<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>Builtin primitive serializers</p>
<p>The serializers for the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/builtin-classes.md#primitives">primitive builtin classes</a> can be retrieved using <code>.serializer()</code> extensions.<br />
可以使用 <code>.serializer()</code> 扩展检索原始内置类的序列化程序。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">intSerializer</span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Int</span><span class="p">.</span><span class="na">serializer</span><span class="p">()</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">intSerializer</span><span class="p">.</span><span class="na">descriptor</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-04.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<h3 id="_6">构造集合序列化程序<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>Constructing collection serializers</p>
<p><a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/builtin-classes.md#lists">Builtin collection serializers</a>, when needed, must be explicitly constructed using the corresponding functions <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.builtins/-list-serializer.html">ListSerializer()</a>, <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.builtins/-set-serializer.html">SetSerializer()</a>, <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.builtins/-map-serializer.html">MapSerializer()</a>, etc. These classes are generic, so to instantiate their serializer we must provide the serializers for the corresponding number of their type parameters. For example, we can produce a serializer for a <code>List&lt;String&gt;</code> in the following way.  </p>
<p>内置集合序列化程序在需要时，必须使用相应的函数 ListSerializer（）、SetSerializer（）、MapSerializer（） 等显式构造。这些类是泛型的，因此要实例化它们的序列化器，我们必须为其相应数量的类型参数提供序列化器。例如，我们可以按以下方式为 a <code>List&lt;String&gt;</code> 生成序列化程序。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stringListSerializer</span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ListSerializer</span><span class="p">(</span><span class="kt">String</span><span class="p">.</span><span class="na">serializer</span><span class="p">())</span><span class="w"> </span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">stringListSerializer</span><span class="p">.</span><span class="na">descriptor</span><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-05.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<h3 id="_7">使用顶级序列化程序功能<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>Using top-level serializer function</p>
<p>When in doubt, you can always use the top-level generic <code>serializer&lt;T&gt;()</code> function to retrieve a serializer for an arbitrary Kotlin type in your source-code.  </p>
<p>如有疑问，您始终可以使用顶级泛型 <code>serializer&lt;T&gt;()</code> 函数在源代码中检索任意 Kotlin 类型的序列化程序。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nd">@Serializable</span><span class="w">            </span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;Color&quot;</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">        </span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stringToColorMapSerializer</span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serializer</span><span class="p">()</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">stringToColorMapSerializer</span><span class="p">.</span><span class="na">descriptor</span><span class="p">)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-06.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<h2 id="_8">自定义序列化程序<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>Custom serializers</p>
<p>A plugin-generated serializer is convenient, but it may not produce the JSON we want for such a class as <code>Color</code>. Let&rsquo;s study alternatives.  </p>
<p>插件生成的序列化程序很方便，但它可能不会为这样的 <code>Color</code> 类生成我们想要的 JSON。让我们研究一下替代方案。</p>
<h3 id="_9">基本类型序列化程序<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>Primitive serializer</p>
<p>We want to serialize the <code>Color</code> class as a hex string with the green color represented as <code>"00ff00"</code>. To achieve this, we write an object that implements the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a> interface for the <code>Color</code> class.  </p>
<p>我们希望将 <code>Color</code> 类序列化为十六进制字符串，绿色表示为 <code>"00ff00"</code> 。为了实现这一点，我们编写了一个对象来实现 <code>Color</code> 该类的 KSerializer 接口。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">ColorAsStringSerializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">descriptor</span><span class="p">:</span><span class="w"> </span><span class="n">SerialDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PrimitiveSerialDescriptor</span><span class="p">(</span><span class="s">&quot;Color&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PrimitiveKind</span><span class="p">.</span><span class="na">STRING</span><span class="p">)</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span><span class="w"> </span><span class="n">Encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="m">16</span><span class="p">).</span><span class="na">padStart</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">        </span><span class="n">encoder</span><span class="p">.</span><span class="na">encodeString</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">):</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeString</span><span class="p">()</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="na">toInt</span><span class="p">(</span><span class="m">16</span><span class="p">))</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>Serializer has three required pieces.<br />
序列化程序有三个必需的部分。</p>
<ul>
<li>
<p>The <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serialization-strategy/serialize.html">serialize</a> function implements <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serialization-strategy/index.html">SerializationStrategy</a>. It receives an instance of <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-encoder/index.html">Encoder</a> and a value to serialize. It uses the <code>encodeXxx</code> functions of <code>Encoder</code> to represent a value as a sequence of primitives. There is an <code>encodeXxx</code> for each primitive type supported by serialization. In our example, <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-encoder/encode-string.html">encodeString</a> is used.  </p>
<p>serialize 函数实现 SerializationStrategy。它接收 Encoder 的实例和要序列化的值。它使用 的 <code>encodeXxx</code> <code>Encoder</code> 函数将值表示为基元序列。序列化支持的每个基元类型都有一个 <code>encodeXxx</code> 。在我们的示例中，使用了 encodeString。</p>
</li>
<li>
<p>The <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-deserialization-strategy/deserialize.html">deserialize</a> function implements <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-deserialization-strategy/index.html">DeserializationStrategy</a>. It receives an instance of <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-decoder/index.html">Decoder</a> and returns a deserialized value. It uses the <code>decodeXxx</code> functions of <code>Decoder</code>, which mirror the corresponding functions of <code>Encoder</code>. In our example <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-decoder/decode-string.html">decodeString</a> is used. </p>
<p>反序列化函数实现 DeserializationStrategy。它接收 Decoder 的实例并返回反序列化值。它使用 <code>Decoder</code> 的 <code>decodeXxx</code> 函数 ，这些函数反映了 的 <code>Encoder</code> 相应函数。在我们的示例中，使用了 decodeString。</p>
</li>
<li>
<p>The <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/descriptor.html">descriptor</a> property must faithfully explain what exactly the <code>encodeXxx</code> and <code>decodeXxx</code> functions do so that a format implementation knows in advance what encoding/decoding methods they call. Some formats might also use it to generate a schema for the serialized data. For primitive serialization, the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.descriptors/-primitive-serial-descriptor.html">PrimitiveSerialDescriptor</a> function must be used with a unique name of the type that is being serialized. <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.descriptors/-primitive-kind/index.html">PrimitiveKind</a> describes the specific <code>encodeXxx</code>/<code>decodeXxx</code> method that is being used in the implementation.  </p>
<p>描述符属性必须忠实地解释 <code>encodeXxx</code> and <code>decodeXxx</code> 函数的确切作用，以便格式实现事先知道它们调用的编码/解码方法。某些格式还可能使用它来生成序列化数据的架构。对于基元序列化，PrimitiveSerialDescriptor 函数必须与要序列化的类型的唯一名称一起使用。PrimitiveKind 描述实现中使用的特定 <code>encodeXxx</code> / <code>decodeXxx</code> 方法。</p>
</li>
</ul>
<blockquote>
<p>When the <code>descriptor</code> does not correspond to the encoding/decoding methods, then the behavior of the resulting code is unspecified, and may arbitrarily change in future updates.  </p>
<p>当 与 <code>descriptor</code> 编码/解码方法不对应时，则生成的代码的行为是未指定的，并且可能会在将来的更新中任意更改。</p>
</blockquote>
<p>The next step is to bind a serializer to a class. This is done with the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializable/index.html"><code>@Serializable</code></a> annotation by adding the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializable/with.html"><code>with</code></a> property value.  </p>
<p>下一步是将序列化程序绑定到类。这是通过添加 <code>with</code> 属性值来 <code>@Serializable</code> 完成注释的。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorAsStringSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span></code></pre></div>
<p>Now we can serialize the <code>Color</code> class as we did before.<br />
现在，我们可以像以前一样序列化 <code>Color</code> 该类。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">x00ff00</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">green</span><span class="p">))</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-07.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>We get the serial representation as the hex string we wanted.<br />
我们得到串行表示为我们想要的十六进制字符串。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>&quot;00ff00&quot;
</span></code></pre></div>
<p>Deserialization is also straightforward because we implemented the <code>deserialize</code> method.  </p>
<p>反序列化也很简单，因为我们实现了该 <code>deserialize</code> 方法。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorAsStringSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="na">decodeFromString</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;\&quot;00ff00\&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">color</span><span class="p">.</span><span class="na">rgb</span><span class="p">)</span><span class="w"> </span><span class="c1">// prints 65280 </span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-08.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>It also works if we serialize or deserialize a different class with <code>Color</code> properties.  </p>
<p>如果我们序列化或反序列化具有 <code>Color</code> 属性的不同类，它也可以工作。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorAsStringSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="nd">@Serializable</span><span class="w"> </span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Settings</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">background</span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">foreground</span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">)</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Settings</span><span class="p">(</span><span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">xffffff</span><span class="p">),</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">    </span><span class="n">require</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">decodeFromString</span><span class="o">&lt;</span><span class="n">Settings</span><span class="o">&gt;</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-09.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>Both <code>Color</code> properties are serialized as strings.<br />
这两个 <code>Color</code> 属性都序列化为字符串。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>{&quot;background&quot;:&quot;ffffff&quot;,&quot;foreground&quot;:&quot;000000&quot;}
</span></code></pre></div>
<h3 id="_10">委派序列化程序<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>Delegating serializers</p>
<p>In the previous example, we represented the <code>Color</code> class as a string. String is considered to be a primitive type, therefore we used <code>PrimitiveClassDescriptor</code> and specialized <code>encodeString</code> method. Now let&rsquo;s see what our actions would be if we have to serialize <code>Color</code> as another non-primitive type, let&rsquo;s say <code>IntArray</code>.  </p>
<p>在前面的示例中，我们将 <code>Color</code> 类表示为字符串。字符串被认为是一种原始类型，因此我们使用了 <code>PrimitiveClassDescriptor</code> 专门 <code>encodeString</code> 的方法。现在让我们看看如果我们必须序列化 <code>Color</code> 为另一种非原始类型，我们的操作会是什么，比如 <code>IntArray</code> 说 .</p>
<p>An implementation of <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a> for our original <code>Color</code> class is going to perform a conversion between <code>Color</code> and <code>IntArray</code>, but delegate the actual serialization logic to the <code>IntArraySerializer</code> using <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-encoder/encode-serializable-value.html">encodeSerializableValue</a> and <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-decoder/decode-serializable-value.html">decodeSerializableValue</a>.  </p>
<p>我们原始 <code>Color</code> 类的 KSerializer 实现将在 和 <code>IntArray</code> 之间 <code>Color</code> 执行转换，但 <code>IntArraySerializer</code> 将实际的序列化逻辑委托给使用 encodeSerializableValue 和 decodeSerializableValue。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.serialization.builtins.IntArraySerializer</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kd">class</span><span class="w"> </span><span class="nc">ColorIntArraySerializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">delegateSerializer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntArraySerializer</span><span class="p">()</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SerialDescriptor</span><span class="p">(</span><span class="s">&quot;Color&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">delegateSerializer</span><span class="p">.</span><span class="na">descriptor</span><span class="p">)</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span><span class="w"> </span><span class="n">Encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intArrayOf</span><span class="p">(</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">            </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">shr</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span><span class="p">,</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">            </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">shr</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span><span class="p">,</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">            </span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xFF</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">        </span><span class="p">)</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">        </span><span class="n">encoder</span><span class="p">.</span><span class="na">encodeSerializableValue</span><span class="p">(</span><span class="n">delegateSerializer</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">):</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeSerializableValue</span><span class="p">(</span><span class="n">delegateSerializer</span><span class="p">)</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Color</span><span class="p">((</span><span class="n">array</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">array</span><span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="p">)</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>Note that we can&rsquo;t use default <code>Color.serializer().descriptor</code> here because formats that rely on the schema may think that we would call <code>encodeInt</code> instead of <code>encodeSerializableValue</code>. Neither we can use <code>IntArraySerializer().descriptor</code> directly — otherwise, formats that handle int arrays specially can&rsquo;t tell if <code>value</code> is really a <code>IntArray</code> or a <code>Color</code>. Don&rsquo;t worry, this optimization would still kick in when serializing actual underlying int array.  </p>
<p>请注意，我们不能在这里使用 default <code>Color.serializer().descriptor</code> ，因为依赖于架构的格式可能会认为我们会调用 <code>encodeInt</code> 而不是 <code>encodeSerializableValue</code> .我们也不能直接使用 <code>IntArraySerializer().descriptor</code> ——否则，专门处理 int 数组的格式无法判断是否真的 <code>value</code> 是 <code>Color</code> a <code>IntArray</code> 或 .别担心，在序列化实际底层 int 数组时，此优化仍会启动。</p>
<blockquote>
<p>Example of how format can treat arrays specially is shown in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/formats.md#format-specific-types">formats guide</a>.<br />
格式指南中显示了格式如何专门处理数组的示例。</p>
</blockquote>
<p>Now we can use the serializer:<br />
现在我们可以使用序列化器：</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorIntArraySerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">x00ff00</span><span class="p">)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">green</span><span class="p">))</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<p>As you can see, such array representation is not very useful in JSON, but may save some space when used with a <code>ByteArray</code> and a binary format.<br />
如您所见，这种数组表示在 JSON 中不是很有用，但在与 a <code>ByteArray</code> 和 binary 格式一起使用时可能会节省一些空间。</p>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-10.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>[0,255,0]
</span></code></pre></div>
<h3 id="_11">通过代理项的复合序列化程序<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>Composite serializer via surrogate</p>
<p>Now our challenge is to get <code>Color</code> serialized so that it is represented in JSON as if it is a class with three properties—<code>r</code>, <code>g</code>, and <code>b</code>—so that JSON encodes it as an object. The easiest way to achieve this is to define a <em>surrogate</em> class mimicking the serialized form of <code>Color</code> that we are going to use for its serialization. We also set the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serial-name/index.html">SerialName</a> of this surrogate class to <code>Color</code>. Then if any format uses this name the surrogate looks like it is a <code>Color</code> class. The surrogate class can be <code>private</code>, and can enforce all the constraints on the serial representation of the class in its <code>init</code> block.  </p>
<p>现在我们的挑战是 <code>Color</code> 序列化，以便用 JSON 表示它，就好像它是一个具有三个属性的类—— <code>r</code> 、 <code>g</code> 和 <code>b</code> ——，以便 JSON 将其编码为对象。实现此目的的最简单方法是定义一个代理项类，该类模仿我们将用于其序列化的序列化形式的 <code>Color</code> 代理项。我们还将此代理项类的 SerialName 设置为 <code>Color</code> 。然后，如果任何格式使用此名称，则代理项看起来像是一个 <code>Color</code> 类。代理项类可以是 <code>private</code> ，并且可以对其 <code>init</code> 块中类的串行表示形式强制执行所有约束。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nd">@Serializable</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nd">@SerialName</span><span class="p">(</span><span class="s">&quot;Color&quot;</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kd">private</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ColorSurrogate</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">r</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">g</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">b</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="k">init</span><span class="w"> </span><span class="p">{</span><span class="w">     </span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="n">require</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="p">)</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>An example of where the class name is used is shown in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/polymorphism.md#custom-subclass-serial-name">Custom subclass serial name</a> section in the chapter on polymorphism.<br />
多态性一章的“自定义子类序列化名称”部分显示了使用类名的示例。</p>
</blockquote>
<p>Now we can use the <code>ColorSurrogate.serializer()</code> function to retrieve a plugin-generated serializer for the surrogate class.  </p>
<p>现在，我们可以使用该 <code>ColorSurrogate.serializer()</code> 函数为代理项类检索插件生成的序列化程序。</p>
<p>We can use the same approach as in <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#delegating-serializers">delegating serializer</a>, but this time, we are fully reusing an automatically generated <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.descriptors/-serial-descriptor/index.html">SerialDescriptor</a> for the surrogate because it should be indistinguishable from the original.  </p>
<p>我们可以使用与委派序列化程序相同的方法，但这一次，我们将完全重用自动生成的 SerialDescriptor 作为代理项，因为它应该与原始描述符无法区分。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">ColorSerializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">descriptor</span><span class="p">:</span><span class="w"> </span><span class="n">SerialDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorSurrogate</span><span class="p">.</span><span class="na">serializer</span><span class="p">().</span><span class="na">descriptor</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span><span class="w"> </span><span class="n">Encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">surrogate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorSurrogate</span><span class="p">((</span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">shr</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xff</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">shr</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xff</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xff</span><span class="p">)</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span><span class="n">encoder</span><span class="p">.</span><span class="na">encodeSerializableValue</span><span class="p">(</span><span class="n">ColorSurrogate</span><span class="p">.</span><span class="na">serializer</span><span class="p">(),</span><span class="w"> </span><span class="n">surrogate</span><span class="p">)</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">):</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">surrogate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeSerializableValue</span><span class="p">(</span><span class="n">ColorSurrogate</span><span class="p">.</span><span class="na">serializer</span><span class="p">())</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Color</span><span class="p">((</span><span class="n">surrogate</span><span class="p">.</span><span class="na">r</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">surrogate</span><span class="p">.</span><span class="na">g</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">surrogate</span><span class="p">.</span><span class="na">b</span><span class="p">)</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>We bind the <code>ColorSerializer</code> serializer to the <code>Color</code> class.<br />
我们将 <code>ColorSerializer</code> 序列化程序绑定到类。 <code>Color</code></p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span></code></pre></div>
<p>Now we can enjoy the result of serialization for the <code>Color</code> class.<br />
现在我们可以享受 <code>Color</code> 类的序列化结果了。</p>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-11.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>{&quot;r&quot;:0,&quot;g&quot;:255,&quot;b&quot;:0}
</span></code></pre></div>
<h3 id="_12">手写复合序列化程序<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>Hand-written composite serializer</p>
<p>There are some cases where a surrogate solution does not fit. Perhaps we want to avoid the performance implications of additional allocation, or we want a configurable/dynamic set of properties for the resulting serial representation. In these cases we need to manually write a class serializer which mimics the behaviour of a generated serializer.  </p>
<p>在某些情况下，替代解决方案不适合。也许我们想避免额外分配对性能的影响，或者我们想要为生成的串行表示提供一组可配置/动态的属性。在这些情况下，我们需要手动编写一个类序列化程序，它模仿生成的序列化程序的行为。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">ColorAsObjectSerializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span></code></pre></div>
<p>Let&rsquo;s introduce it piece by piece. First, a descriptor is defined using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.descriptors/build-class-serial-descriptor.html">buildClassSerialDescriptor</a> builder. The <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.descriptors/element.html">element</a> function in the builder DSL automatically fetches serializers for the corresponding fields by their type. The order of elements is important. They are indexed starting from zero.  </p>
<p>让我们一点一点地介绍一下。首先，使用 buildClassSerialDescriptor 生成器定义描述符。生成器 DSL 中的 element 函数会按类型自动获取相应字段的序列化程序。元素的顺序很重要。它们从零开始编制索引。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">descriptor</span><span class="p">:</span><span class="w"> </span><span class="n">SerialDescriptor</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">        </span><span class="n">buildClassSerialDescriptor</span><span class="p">(</span><span class="s">&quot;Color&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">            </span><span class="n">element</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">            </span><span class="n">element</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">)</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">            </span><span class="n">element</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>The &ldquo;element&rdquo; is a generic term here. What is an element of a descriptor depends on its <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.descriptors/-serial-kind/index.html">SerialKind</a>. Elements of a class descriptor are its properties, elements of a enum descriptor are its cases, etc.<br />
“元素”在这里是一个通用术语。什么是描述符的元素取决于其 SerialKind。类描述符的元素是它的属性，枚举描述符的元素是它的大小写，等等。</p>
</blockquote>
<p>Then we write the <code>serialize</code> function using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/encode-structure.html">encodeStructure</a> DSL that provides access to the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-composite-encoder/index.html">CompositeEncoder</a> in its block. The difference between <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-encoder/index.html">Encoder</a> and <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-composite-encoder/index.html">CompositeEncoder</a> is the latter has <code>encodeXxxElement</code> functions that correspond to the <code>encodeXxx</code> functions of the former. They must be called in the same order as in the descriptor.  </p>
<p>然后，我们使用 encodeStructure DSL 编写函数， <code>serialize</code> 该 DSL 提供对其块中 CompositeEncoder 的访问。Encoder 和 CompositeEncoder 之间的区别在于后者具有 <code>encodeXxxElement</code> 与前者 <code>encodeXxx</code> 的功能相对应的功能。必须按照描述符中的相同顺序调用它们。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span><span class="w"> </span><span class="n">Encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">Color</span><span class="p">)</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">        </span><span class="n">encoder</span><span class="p">.</span><span class="na">encodeStructure</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">            </span><span class="n">encodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">shr</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xff</span><span class="p">)</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">            </span><span class="n">encodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">shr</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xff</span><span class="p">)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">            </span><span class="n">encodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">rgb</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="m">0</span><span class="n">xff</span><span class="p">)</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>The most complex piece of code is the <code>deserialize</code> function. It must support formats, like JSON, that can decode properties in an arbitrary order. It starts with the call to <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/decode-structure.html">decodeStructure</a> to get access to a <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-composite-decoder/index.html">CompositeDecoder</a>. Inside it we write a loop that repeatedly calls <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-composite-decoder/decode-element-index.html">decodeElementIndex</a> to decode the index of the next element, then we decode the corresponding element using <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-composite-decoder/decode-int-element.html">decodeIntElement</a> in our example, and finally we terminate the loop when <code>CompositeDecoder.DECODE_DONE</code> is encountered.  </p>
<p>最复杂的代码是 <code>deserialize</code> 函数。它必须支持可以按任意顺序解码属性的格式，例如 JSON。它从调用 decodeStructure 开始，以获取对 CompositeDecoder 的访问权限。在里面，我们编写了一个循环，反复调用 decodeElementIndex 来解码下一个元素的索引，然后我们在我们的示例中使用 decodeIntElement 解码相应的元素，最后在遇到循环时 <code>CompositeDecoder.DECODE_DONE</code> 终止循环。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">):</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">        </span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeStructure</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nv">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="w">                </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeElementIndex</span><span class="p">(</span><span class="n">descriptor</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">                    </span><span class="m">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">                    </span><span class="m">2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">                    </span><span class="n">CompositeDecoder</span><span class="p">.</span><span class="na">DECODE_DONE</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">break</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Unexpected index: </span><span class="si">$</span><span class="n">index</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">            </span><span class="n">require</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="p">)</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">            </span><span class="n">Color</span><span class="p">((</span><span class="n">r</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>Now we bind the resulting serializer to the <code>Color</code> class and test its serialization/deserialization.  </p>
<p>现在，我们将生成的序列化程序绑定到类并 <code>Color</code> 测试其序列化/反序列化。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ColorAsObjectSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Color</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">rgb</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span><span class="p">(</span><span class="m">0</span><span class="n">x00ff00</span><span class="p">)</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">color</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">    </span><span class="n">require</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">decodeFromString</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">color</span><span class="p">)</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-12.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>As before, we got the <code>Color</code> class represented as a JSON object with three keys:<br />
和以前一样，我们将 <code>Color</code> 类表示为具有三个键的 JSON 对象：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>{&quot;r&quot;:0,&quot;g&quot;:255,&quot;b&quot;:0}
</span></code></pre></div>
<h3 id="_13">顺序解码协议（实验性）<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>Sequential decoding protocol (experimental)</p>
<p>The implementation of the <code>deserialize</code> function from the previous section works with any format. However, some formats either always store all the complex data in order, or only do so sometimes (JSON always stores collections in order). With these formats the complex protocol of calling <code>decodeElementIndex</code> in the loop is not needed, and a faster implementation can be used if the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.encoding/-composite-decoder/decode-sequentially.html">CompositeDecoder.decodeSequentially</a> function returns <code>true</code>. The plugin-generated serializers are actually conceptually similar to the below code.  </p>
<p>上一节 <code>deserialize</code> 中函数的实现适用于任何格式。但是，某些格式要么始终按顺序存储所有复杂数据，要么仅偶尔这样做（JSON 始终按顺序存储集合）。使用这些格式，不需要在循环中调用 <code>decodeElementIndex</code> 的复杂协议，如果 CompositeDecoder.decodeSequentially 函数返回 <code>true</code> ，则可以使用更快的实现。插件生成的序列化程序实际上在概念上类似于下面的代码。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">):</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">        </span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeStructure</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nv">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="m">1</span><span class="w">     </span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">decodeSequentially</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// sequential decoding protocol</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">           </span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">                </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w">                </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeElementIndex</span><span class="p">(</span><span class="n">descriptor</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">                    </span><span class="m">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">                    </span><span class="m">1</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">                    </span><span class="m">2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decodeIntElement</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">                    </span><span class="n">CompositeDecoder</span><span class="p">.</span><span class="na">DECODE_DONE</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">break</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">                    </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Unexpected index: </span><span class="si">$</span><span class="n">index</span><span class="s">&quot;</span><span class="p">)</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">            </span><span class="n">require</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">0.</span><span class="p">.</span><span class="m">255</span><span class="p">)</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">            </span><span class="n">Color</span><span class="p">((</span><span class="n">r</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">16</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="n">shl</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-13.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<h3 id="_14">序列化第三方类<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>Serializing 3rd party classes </p>
<p>Sometimes an application has to work with an external type that is not serializable. Let us use <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Date.html">java.util.Date</a> as an example. As before, we start by writing an implementation of <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a> for the class. Our goal is to get a <code>Date</code> serialized as a long number of milliseconds following the approach from the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#primitive-serializer">Primitive serializer</a> section.  </p>
<p>有时，应用程序必须使用不可序列化的外部类型。让我们以 java.util.Date 为例。和以前一样，我们首先为该类编写 KSerializer 的实现。我们的目标是按照 Primitive 序列化程序部分的方法将序列 <code>Date</code> 化为长毫秒。</p>
<blockquote>
<p>In the following sections any kind of <code>Date</code> serializer would work. For example, if we want <code>Date</code> to be serialized as an object, we would use an approach from the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#composite-serializer-via-surrogate">Composite serializer via surrogate</a> section.  </p>
<p>在以下各节中，任何类型的 <code>Date</code> 序列化程序都可以使用。例如，如果我们想 <code>Date</code> 序列化为对象，我们将使用 Composite serializer via surrogate 部分的方法。  </p>
<p>See also <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#deriving-external-serializer-for-another-kotlin-class-experimental">Deriving external serializer for another Kotlin class (experimental)</a> when you need to serialize a 3rd-party Kotlin class that could have been serializable, but is not.  </p>
<p>另请参阅 当您需要序列化本来可以序列化但不可序列化的第三方 Kotlin 类时，请为另一个 Kotlin 类派生外部序列化器（实验性）。</p>
</blockquote>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kd">object</span><span class="w"> </span><span class="nc">DateAsLongSerializer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">descriptor</span><span class="p">:</span><span class="w"> </span><span class="n">SerialDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PrimitiveSerialDescriptor</span><span class="p">(</span><span class="s">&quot;Date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PrimitiveKind</span><span class="p">.</span><span class="na">LONG</span><span class="p">)</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span><span class="w"> </span><span class="n">Encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">encoder</span><span class="p">.</span><span class="na">encodeLong</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">time</span><span class="p">)</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">):</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeLong</span><span class="p">())</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>We cannot bind the <code>DateAsLongSerializer</code> serializer to the <code>Date</code> class with the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializable/index.html"><code>@Serializable</code></a> annotation because we don&rsquo;t control the <code>Date</code> source code. There are several ways to work around that.  </p>
<p>我们无法将 <code>DateAsLongSerializer</code> 序列化程序绑定到带有 <code>@Serializable</code> 注释的类， <code>Date</code> 因为我们无法控制 <code>Date</code> 源代码。有几种方法可以解决这个问题。</p>
<h3 id="_15">手动传递序列化程序<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>Passing a serializer manually</p>
<p>All <code>encodeToXxx</code> and <code>decodeFromXxx</code> functions have an overload with the first serializer parameter. When a non-serializable class, like <code>Date</code>, is the top-level class being serialized, we can use those.  </p>
<p>All <code>encodeToXxx</code> 和 <code>decodeFromXxx</code> functions 具有第一个序列化程序参数的重载。当不可序列化的类（如 <code>Date</code> ）是要序列化的顶级类时，我们可以使用它们。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">                                              </span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">kotlin10ReleaseDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-ddX&quot;</span><span class="p">).</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2016-02-15+00&quot;</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">DateAsLongSerializer</span><span class="p">,</span><span class="w"> </span><span class="n">kotlin10ReleaseDate</span><span class="p">))</span><span class="w">    </span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-14.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>1455494400000
</span></code></pre></div>
<h3 id="_16">在属性上指定序列化程序<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>Specifying serializer on a property</p>
<p>When a property of a non-serializable class, like <code>Date</code>, is serialized as part of a serializable class we must supply its serializer or the code will not compile. This is accomplished using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializable/index.html"><code>@Serializable</code></a> annotation on the property.  </p>
<p>当不可序列化类的属性（如 <code>Date</code> ）作为可序列化类的一部分序列化时，我们必须提供其序列化器，否则代码将无法编译。这是使用属性上的 <code>@Serializable</code> 注释完成的。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nd">@Serializable</span><span class="w">          </span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">ProgrammingLanguage</span><span class="p">(</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateAsLongSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stableReleaseDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">)</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProgrammingLanguage</span><span class="p">(</span><span class="s">&quot;Kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-ddX&quot;</span><span class="p">).</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2016-02-15+00&quot;</span><span class="p">))</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-15.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>The <code>stableReleaseDate</code> property is serialized with the serialization strategy that we specified for it:<br />
该 <code>stableReleaseDate</code> 属性使用我们为其指定的序列化策略进行序列化：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>{&quot;name&quot;:&quot;Kotlin&quot;,&quot;stableReleaseDate&quot;:1455494400000}
</span></code></pre></div>
<h3 id="_17">为特定类型指定序列化程序<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>Specifying serializer for a particular type</p>
<p><a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializable/index.html"><code>@Serializable</code></a> annotation can also be applied directly to the types. This is handy when a class that requires a custom serializer, such as <code>Date</code>, happens to be a generic type argument. The most common use case for that is when you have a list of dates:  </p>
<p><code>@Serializable</code> 注释也可以直接应用于类型。当需要自定义序列化程序的类（如 <code>Date</code> ）恰好是泛型类型参数时，这很方便。最常见的用例是当您有一个日期列表时：</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nd">@Serializable</span><span class="w">          </span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">ProgrammingLanguage</span><span class="p">(</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">releaseDates</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="nd">@Serializable</span><span class="p">(</span><span class="n">DateAsLongSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="n">Date</span><span class="o">&gt;</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="p">)</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-ddX&quot;</span><span class="p">)</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProgrammingLanguage</span><span class="p">(</span><span class="s">&quot;Kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">listOf</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2023-07-06+00&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2023-04-25+00&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2022-12-28+00&quot;</span><span class="p">)))</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-16.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>{&quot;name&quot;:&quot;Kotlin&quot;,&quot;releaseDates&quot;:[1688601600000,1682380800000,1672185600000]}
</span></code></pre></div>
<h3 id="_18">指定文件的序列化程序<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>Specifying serializers for a file </p>
<p>A serializer for a specific type, like <code>Date</code>, can be specified for a whole source code file with the file-level <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-use-serializers/index.html">UseSerializers</a> annotation at the beginning of the file.  </p>
<p>可以为整个源代码文件指定特定类型的序列化程序，例如 <code>Date</code> ，文件开头带有文件级 UseSerializers 注释。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nd">@file</span><span class="p">:</span><span class="n">UseSerializers</span><span class="p">(</span><span class="n">DateAsLongSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span></code></pre></div>
<p>Now a <code>Date</code> property can be used in a serializable class without additional annotations.<br />
现在，可以在可序列化类中使用属性 <code>Date</code> ，而无需添加注释。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nd">@Serializable</span><span class="w">          </span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">ProgrammingLanguage</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">stableReleaseDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span><span class="p">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProgrammingLanguage</span><span class="p">(</span><span class="s">&quot;Kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-ddX&quot;</span><span class="p">).</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2016-02-15+00&quot;</span><span class="p">))</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-17.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>{&quot;name&quot;:&quot;Kotlin&quot;,&quot;stableReleaseDate&quot;:1455494400000}
</span></code></pre></div>
<h3 id="typealias">使用 typealias 全局指定序列化程序<a class="headerlink" href="#typealias" title="Permanent link">&para;</a></h3>
<p>Specifying serializer globally using typealias</p>
<p>kotlinx.serialization tends to be the always-explicit framework when it comes to serialization strategies: normally, they should be explicitly mentioned in <code>@Serializable</code> annotation. Therefore, we do not provide any kind of global serializer configuration (except for <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#contextual-serialization">context serializer</a> mentioned later).  </p>
<p>当涉及到序列化策略时，kotlinx.serialization 往往是始终明确的框架：通常，它们应该在注释中 <code>@Serializable</code> 显式提及。因此，我们不提供任何类型的全局序列化程序配置（后面提到的上下文序列化程序除外）。</p>
<p>However, in projects with a large number of files and classes, it may be too cumbersome to specify <code>@file:UseSerializers</code> every time, especially for classes like <code>Date</code> or <code>Instant</code> that have a fixed strategy of serialization across the project. For such cases, it is possible to specify serializers using <code>typealias</code>es, as they preserve annotations, including serialization-related ones:  </p>
<p>但是，在具有大量文件和类的项目中，每次都指定 <code>@file:UseSerializers</code> 可能太麻烦，尤其是对于像 OR <code>Date</code> <code>Instant</code> 这样的类，这些类在整个项目中具有固定的序列化策略。对于这种情况，可以使用 <code>typealias</code> es 指定序列化程序，因为它们会保留注释，包括与序列化相关的注释：</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">typealias</span><span class="w"> </span><span class="n">DateAsLong</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Serializable</span><span class="p">(</span><span class="n">DateAsLongSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="n">Date</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="k">typealias</span><span class="w"> </span><span class="n">DateAsText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@Serializable</span><span class="p">(</span><span class="n">DateAsSimpleTextSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="n">Date</span>
</span></code></pre></div>
<p>Using these new different types, it is possible to serialize a Date differently without additional annotations:<br />
使用这些新的不同类型，可以在没有额外注释的情况下以不同的方式序列化 Date：</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nd">@Serializable</span><span class="w">          </span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">ProgrammingLanguage</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">stableReleaseDate</span><span class="p">:</span><span class="w"> </span><span class="n">DateAsText</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">lastReleaseTimestamp</span><span class="p">:</span><span class="w"> </span><span class="n">DateAsLong</span><span class="p">)</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-ddX&quot;</span><span class="p">)</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProgrammingLanguage</span><span class="p">(</span><span class="n">format</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2016-02-15+00&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">format</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2022-07-07+00&quot;</span><span class="p">))</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-18.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>{&quot;stableReleaseDate&quot;:&quot;2016-02-15&quot;,&quot;lastReleaseTimestamp&quot;:1657152000000}
</span></code></pre></div>
<h3 id="_19">泛型类型的自定义序列化程序<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>Custom serializers for a generic type</p>
<p>Let us take a look at the following example of the generic <code>Box&lt;T&gt;</code> class. It is marked with <code>@Serializable(with = BoxSerializer::class)</code> as we plan to have a custom serialization strategy for it.  </p>
<p>让我们看一下下面的泛型 <code>Box&lt;T&gt;</code> 类示例。它被标记为 <code>@Serializable(with = BoxSerializer::class)</code> 我们计划为其制定自定义序列化策略。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BoxSerializer</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">contents</span><span class="p">:</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span>
</span></code></pre></div>
<p>An implementation of <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a> for a regular type is written as an <code>object</code>, as we saw in this chapter&rsquo;s examples for the <code>Color</code> type. A generic class serializer is instantiated with serializers for its generic parameters. We saw this in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#plugin-generated-generic-serializer">Plugin-generated generic serializer</a> section. A custom serializer for a generic class must be a <code>class</code> with a constructor that accepts as many <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-k-serializer/index.html">KSerializer</a> parameters as the type has generic parameters. Let us write a <code>Box&lt;T&gt;</code> serializer that erases itself during serialization, delegating everything to the underlying serializer of its <code>data</code> property.  </p>
<p>常规类型的 KSerializer 实现被写成 ，正如我们在本章的 <code>Color</code> 该类型的示例中看到的那样 <code>object</code> 。泛型类序列化程序使用序列化程序实例化其泛型参数。我们在插件生成的泛型序列化程序部分中看到了这一点。泛型类的自定义序列化程序必须是 <code>class</code> 具有构造函数的构造函数，该构造函数接受与类型具有泛型参数的 KSerializer 参数一样多的 KSerializer 参数。让我们编写一个 <code>Box&lt;T&gt;</code> 序列化程序，该序列化器在序列化过程中擦除自身，将所有内容委托给其 <code>data</code> 属性的基础序列化程序。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kd">class</span><span class="w"> </span><span class="nc">BoxSerializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">dataSerializer</span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KSerializer</span><span class="o">&lt;</span><span class="n">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">descriptor</span><span class="p">:</span><span class="w"> </span><span class="n">SerialDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSerializer</span><span class="p">.</span><span class="na">descriptor</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span><span class="w"> </span><span class="n">Encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="n">Box</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSerializer</span><span class="p">.</span><span class="na">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="na">contents</span><span class="p">)</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span><span class="w"> </span><span class="n">Decoder</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Box</span><span class="p">(</span><span class="n">dataSerializer</span><span class="p">.</span><span class="na">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">))</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now we can serialize and deserialize <code>Box&lt;Project&gt;</code>.<br />
现在我们可以序列化和反序列化 <code>Box&lt;Project&gt;</code> 。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nd">@Serializable</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">Project</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Box</span><span class="p">(</span><span class="n">Project</span><span class="p">(</span><span class="s">&quot;kotlinx.serialization&quot;</span><span class="p">))</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">decodeFromString</span><span class="o">&lt;</span><span class="n">Box</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-19.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>The resulting JSON looks like the <code>Project</code> class was serialized directly.<br />
生成的 JSON 看起来像是 <code>Project</code> 直接序列化的类。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>{&quot;name&quot;:&quot;kotlinx.serialization&quot;}
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>Box(contents=Project(name=kotlinx.serialization))
</span></code></pre></div>
<h3 id="_20">特定于格式的序列化程序<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>Format-specific serializers</p>
<p>The above custom serializers worked in the same way for every format. However, there might be format-specific features that a serializer implementation would like to take advantage of.<br />
上述自定义序列化程序对每种格式都以相同的方式工作。但是，序列化程序实现可能希望利用特定于格式的功能。</p>
<ul>
<li>
<p>The <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/json.md#json-transformations">Json transformations</a> section of the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/json.md">Json</a> chapter provides examples of serializers that utilize JSON-specific features.<br />
    Json 一章的 Json 转换部分提供了利用 JSON 特定功能的序列化程序的示例。</p>
</li>
<li>
<p>A format implementation can have a format-specific representation for a type as explained in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/formats.md#format-specific-types">Format-specific types</a> section of the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/formats.md">Alternative and custom formats (experimental)</a> chapter.<br />
    格式实现可以具有特定于类型的格式表示形式，如替代格式和自定义格式（实验）一章的特定于格式的类型部分所述。</p>
</li>
</ul>
<p>This chapter proceeds with a generic approach to tweaking the serialization strategy based on the context.<br />
本章继续采用一种通用方法，根据上下文调整序列化策略。</p>
<h2 id="_21">上下文序列化<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<p>Contextual serialization</p>
<p>All the previous approaches to specifying custom serialization strategies were <em>static</em>, that is fully defined at compile-time. The exception was the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#passing-a-serializer-manually">Passing a serializer manually</a> approach, but it worked only on a top-level object. You might need to change the serialization strategy for objects deep in the serialized object tree at run-time, with the strategy being selected in a context-dependent way. For example, you might want to represent <code>java.util.Date</code> in JSON format as an ISO 8601 string or as a long integer depending on a version of a protocol you are serializing data for. This is called <em>contextual</em> serialization, and it is supported by a built-in <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-contextual-serializer/index.html">ContextualSerializer</a> class. Usually we don&rsquo;t have to use this serializer class explicitly—there is the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-contextual/index.html">Contextual</a> annotation providing a shortcut to the <code>@Serializable(with = ContextualSerializer::class)</code> annotation, or the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-use-contextual-serialization/index.html">UseContextualSerialization</a> annotation can be used at the file-level just like the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-use-serializers/index.html">UseSerializers</a> annotation. Let&rsquo;s see an example utilizing the former.  </p>
<p>以前所有指定自定义序列化策略的方法都是静态的，在编译时完全定义。例外情况是手动传递序列化程序方法，但它仅适用于顶级对象。您可能需要在运行时更改序列化对象树深处对象的序列化策略，并以上下文相关的方式选择该策略。例如，您可能希望以 JSON 格式表示 <code>java.util.Date</code> 为 ISO 8601 字符串或长整数，具体取决于要序列化数据的协议版本。这称为上下文序列化，它由内置的 ContextualSerializer 类支持。通常，我们不必显式使用此序列化程序类 - 有 Contextual 注释提供注释的快捷方式 <code>@Serializable(with = ContextualSerializer::class)</code> ，或者 UseContextualSerialization 注释可以在文件级别使用，就像 UseSerializers 注释一样。让我们看一个使用前者的例子。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nd">@Serializable</span><span class="w">          </span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">ProgrammingLanguage</span><span class="p">(</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="w">    </span><span class="nd">@Contextual</span><span class="w"> </span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">stableReleaseDate</span><span class="p">:</span><span class="w"> </span><span class="n">Date</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="p">)</span>
</span></code></pre></div>
<p>To actually serialize this class we must provide the corresponding context when calling the <code>encodeToXxx</code>/<code>decodeFromXxx</code> functions. Without it we&rsquo;ll get a &ldquo;Serializer for class &lsquo;Date&rsquo; is not found&rdquo; exception.<br />
为了实际序列化此类， <code>encodeToXxx</code> 我们必须在调用 / <code>decodeFromXxx</code> 函数时提供相应的上下文。如果没有它，我们将得到“找不到类&rsquo;Date&rsquo;的序列化程序”异常。</p>
<blockquote>
<p>See <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-20.kt">here</a> for an example that produces that exception.<br />
有关生成该异常的示例，请参阅此处。</p>
</blockquote>
<h3 id="_22">序列化模块<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>Serializers module</p>
<p>To provide a context, we define a <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.modules/-serializers-module/index.html">SerializersModule</a> instance that describes which serializers shall be used at run-time to serialize which contextually-serializable classes. This is done using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.modules/-serializers-module.html">SerializersModule {}</a> builder function, which provides the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.modules/-serializers-module-builder/index.html">SerializersModuleBuilder</a> DSL to register serializers. In the below example we use the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization.modules/contextual.html">contextual</a> function with the serializer. The corresponding class this serializer is defined for is fetched automatically via the <code>reified</code> type parameter.  </p>
<p>为了提供上下文，我们定义了一个 SerializersModule 实例，该实例描述在运行时应使用哪些序列化程序来序列化哪些上下文可序列化的类。这是使用 SerializersModule {} 生成器函数完成的，该函数提供 SerializersModuleBuilder DSL 来注册序列化程序。在下面的示例中，我们将上下文函数与序列化程序一起使用。为此序列化程序定义的相应类是通过 <code>reified</code> type 参数自动提取的。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SerializersModule</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="n">contextual</span><span class="p">(</span><span class="n">DateAsLongSerializer</span><span class="p">)</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="p">}</span>
</span></code></pre></div>
<p>Next we create an instance of the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-json/kotlinx.serialization.json/-json/index.html">Json</a> format with this module using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-json/kotlinx.serialization.json/-json.html">Json {}</a> builder function and the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-json/kotlinx.serialization.json/-json-builder/serializers-module.html">serializersModule</a> property.  </p>
<p>接下来，我们使用 Json {} builder 函数和 serializersModule 属性使用此模块创建 Json 格式的实例。</p>
<blockquote>
<p>Details on custom JSON configurations can be found in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/json.md#json-configuration">JSON configuration</a> section.<br />
有关自定义 JSON 配置的详细信息，请参阅 JSON 配置部分。</p>
</blockquote>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Json</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">serializersModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Now we can serialize our data with this <code>format</code>.<br />
现在我们可以用这个 <code>format</code> 序列化我们的数据。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProgrammingLanguage</span><span class="p">(</span><span class="s">&quot;Kotlin&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-ddX&quot;</span><span class="p">).</span><span class="na">parse</span><span class="p">(</span><span class="s">&quot;2016-02-15+00&quot;</span><span class="p">))</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">format</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-21.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>{&quot;name&quot;:&quot;Kotlin&quot;,&quot;stableReleaseDate&quot;:1455494400000}
</span></code></pre></div>
<h3 id="_23">上下文序列化和泛型类<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>Contextual serialization and generic classes</p>
<p>In the previous section we saw that we can register serializer instance in the module for a class we want to serialize contextually. We also know that <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#custom-serializers-for-a-generic-type">serializers for generic classes have constructor parameters</a> — type arguments serializers. It means that we can&rsquo;t use one serializer instance for a class if this class is generic:  </p>
<p>在上一节中，我们看到我们可以在模块中为要在上下文中序列化的类注册序列化程序实例。我们还知道泛型类的序列化程序具有构造函数参数 — 类型参数序列化程序。这意味着如果一个类是泛型的，我们不能为一个类使用一个序列化程序实例：</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">incorrectModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SerializersModule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="c1">// Can serialize only Box&lt;Int&gt;, but not Box&lt;String&gt; or others</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">    </span><span class="n">contextual</span><span class="p">(</span><span class="n">BoxSerializer</span><span class="p">(</span><span class="kt">Int</span><span class="p">.</span><span class="na">serializer</span><span class="p">()))</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>For cases when one want to serialize contextually a generic class, it is possible to register provider in the module:  </p>
<p>对于想要在上下文中序列化泛型类的情况，可以在模块中注册提供程序：</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kd">val</span><span class="w"> </span><span class="nv">correctModule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SerializersModule</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="c1">// args[0] contains Int.serializer() or String.serializer(), depending on the usage</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="n">contextual</span><span class="p">(</span><span class="n">Box</span><span class="o">::</span><span class="n">class</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">BoxSerializer</span><span class="p">(</span><span class="n">args</span><span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>Additional details on serialization modules are given in the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/polymorphism.md#merging-library-serializers-modules">Merging library serializers modules</a> section of the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/polymorphism.md">Polymorphism</a> chapter.<br />
有关序列化模块的其他详细信息，请参阅 Polymorphism 一章的合并库序列化程序模块部分。</p>
</blockquote>
<h2 id="kotlin">为另一个 Kotlin 类派生外部序列化程序（实验性）<a class="headerlink" href="#kotlin" title="Permanent link">&para;</a></h2>
<p>Deriving external serializer for another Kotlin class (experimental)</p>
<p>If a 3rd-party class to be serialized is a Kotlin class with a properties-only primary constructor, a kind of class which could have been made <code>@Serializable</code>, then you can generate an <em>external</em> serializer for it using the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializer/index.html">Serializer</a> annotation on an object with the <a href="https://kotlinlang.org/api/kotlinx.serialization/kotlinx-serialization-core/kotlinx.serialization/-serializer/for-class.html"><code>forClass</code></a> property.  </p>
<p>如果要序列化的第三方类是具有仅属性主构造函数的 Kotlin 类，这是一种可以创建 <code>@Serializable</code> 的类，那么您可以使用具有该 <code>forClass</code> 属性的对象上的序列化程序注释为其生成外部序列化程序。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1">// NOT @Serializable</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Project</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">,</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">language</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="nd">@Serializer</span><span class="p">(</span><span class="n">forClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="kd">object</span><span class="w"> </span><span class="nc">ProjectSerializer</span>
</span></code></pre></div>
<p>You must bind this serializer to a class using one of the approaches explained in this chapter. We&rsquo;ll follow the <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/serializers.md#passing-a-serializer-manually">Passing a serializer manually</a> approach for this example.<br />
必须使用本章中介绍的方法之一将此序列化程序绑定到类。对于此示例，我们将遵循手动传递序列化程序方法。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="s">&quot;kotlinx.serialization&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Kotlin&quot;</span><span class="p">)</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">ProjectSerializer</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span><span class="w">    </span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-22.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>This gets all the <code>Project</code> properties serialized:<br />
这将使所有 <code>Project</code> 属性序列化：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>{&quot;name&quot;:&quot;kotlinx.serialization&quot;,&quot;language&quot;:&quot;Kotlin&quot;}
</span></code></pre></div>
<h3 id="_24">外部序列化使用属性<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>External serialization uses properties</p>
<p>As we saw earlier, the regular <code>@Serializable</code> annotation creates a serializer so that <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/basic-serialization.md#backing-fields-are-serialized">Backing fields are serialized</a>. <em>External</em> serialization using <code>Serializer(forClass = ...)</code> has no access to backing fields and works differently. It serializes only <em>accessible</em> properties that have setters or are part of the primary constructor. The following example shows this.  </p>
<p>正如我们之前所看到的，常规 <code>@Serializable</code> 注释会创建一个序列化程序，以便序列化 Backing 字段。外部序列化使用 <code>Serializer(forClass = ...)</code> 无法访问后备字段，并且工作方式不同。它仅序列化具有 setter 或属于主构造函数的可访问属性。以下示例演示了这一点。</p>
<div class="language-kotlin highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1">// NOT @Serializable, will use external serializer</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="kd">class</span><span class="w"> </span><span class="nc">Project</span><span class="p">(</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="c1">// val in a primary constructor -- serialized</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">name</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nv">stars</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c1">// property with getter &amp; setter -- serialized</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">path</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="w"> </span><span class="c1">// getter only -- not serialized</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w">        </span><span class="k">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;kotlin/</span><span class="si">$</span><span class="n">name</span><span class="s">&quot;</span><span class="w">                                         </span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">locked</span><span class="p">:</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="c1">// private, not accessible -- not serialized </span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="p">}</span><span class="w">              </span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="nd">@Serializer</span><span class="p">(</span><span class="n">forClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="kd">object</span><span class="w"> </span><span class="nc">ProjectSerializer</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Project</span><span class="p">(</span><span class="s">&quot;kotlinx.serialization&quot;</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">stars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9000</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="w">    </span><span class="n">println</span><span class="p">(</span><span class="n">Json</span><span class="p">.</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">ProjectSerializer</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">))</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="p">}</span>
</span></code></pre></div>
<blockquote>
<p>You can get the full code <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/guide/example/example-serializer-23.kt">here</a>.<br />
您可以在此处获取完整代码。</p>
</blockquote>
<p>The output is shown below.<br />
输出如下所示。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>{&quot;name&quot;:&quot;kotlinx.serialization&quot;,&quot;stars&quot;:9000}
</span></code></pre></div>
<hr />
<p>The next chapter covers <a href="https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/polymorphism.md">Polymorphism</a>.<br />
下一章将介绍多态性。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../%E5%86%85%E7%BD%AE%E7%B1%BB-2/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 内置类">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                内置类
              </div>
            </div>
          </a>
        
        
          
          <a href="../%E5%A4%9A%E6%80%81%E6%80%A7-4/" class="md-footer__link md-footer__link--next" aria-label="下一页: 多态性">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                多态性
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018 - 2024 knightwood
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.prune", "navigation.footer", "navigation.instant", "search.highlight", "search.suggest", "search.share", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  </body>
</html>